var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,r){return new(i||(i=Promise))(function(o,n){function s(t){try{h(r.next(t))}catch(e){n(e)}}function a(t){try{h(r["throw"](t))}catch(e){n(e)}}function h(t){t.done?o(t.value):new i(function(e){e(t.value)}).then(s,a)}h((r=r.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return r([t,e])}}function r(i){if(o)throw new TypeError("Generator is already executing.");for(;h;)try{if(o=1,n&&(s=n[2&i[0]?"return":i[0]?"throw":"next"])&&!(s=s.call(n,i[1])).done)return s;switch(n=0,s&&(i=[0,s.value]),i[0]){case 0:case 1:s=i;break;case 4:return h.label++,{value:i[1],done:!1};case 5:h.label++,n=i[1],i=[0];continue;case 7:i=h.ops.pop(),h.trys.pop();continue;default:if(s=h.trys,!(s=s.length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){h=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){h.label=i[1];break}if(6===i[0]&&h.label<s[1]){h.label=s[1],s=i;break}if(s&&h.label<s[2]){h.label=s[2],h.ops.push(i);break}s[2]&&h.ops.pop(),h.trys.pop();continue}i=e.call(t,h)}catch(r){i=[6,r],n=0}finally{o=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var o,n,s,a,h={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},MyComponent=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.constructFromResource=function(){t.prototype.constructFromResource.call(this),this.myload()},e.prototype.myload=function(){},e.prototype.createObject=function(t){return fairygui.UIPackage.createObject(Data.pkgName,t)},e.prototype.registComponent=function(t,e,i){fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(t,e),i)},e}(fairygui.GComponent);__reflect(MyComponent.prototype,"MyComponent");var FairyWindow=function(t){function e(e,i){var r=t.call(this)||this;return r.m_pPackName=e,r.m_pResName=i,fairygui.UIPackage.addPackage(e),egret.lifecycle.stage.addChild(fairygui.GRoot.inst.displayObject),r.onInit(),r}return __extends(e,t),e.prototype.onInit=function(){this.initComponents(),this.initView(),this.initListen()},e.prototype.initListen=function(){},e.prototype.initComponents=function(){},e.prototype.registComponent=function(t,e){fairygui.UIObjectFactory.setPackageItemExtension(fairygui.UIPackage.getItemURL(this.m_pPackName,t),e)},e.prototype.initView=function(){if(""!=this.m_pResName){var t=this.createObject(this.m_pResName);if(!t)return void console.error("[FairyWindow] initView() createObject is null",this.m_pPackName,this.m_pResName);this._ui=t.asCom,fairygui.GRoot.inst.addChild(this._ui)}},e.prototype.createObject=function(t){return fairygui.UIPackage.createObject(this.m_pPackName,t)},e.prototype.dispose=function(){this._ui&&(this._ui.dispose(),this._ui=null),t.prototype.dispose.call(this)},e}(MyComponent);__reflect(FairyWindow.prototype,"FairyWindow");var DragPro;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.myload=function(){},e}(MyComponent);t.Trapezoid=e,__reflect(e.prototype,"DragPro.Trapezoid")}(DragPro||(DragPro={}));var AstarPra;!function(t){var e=function(){function t(){}return t.MAX_ROW=28,t.MAX_COL=20,t.touchNum=0,t.TOUCH_GRID="touch_grid",t}();t.Data=e,__reflect(e.prototype,"AstarPra.Data")}(AstarPra||(AstarPra={}));var AstarPra;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.myload=function(){var t=this;t._control=t.getControllerAt(0),this.addListen()},Object.defineProperty(i.prototype,"row",{set:function(t){this._row=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"col",{set:function(t){this._col=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"control",{set:function(t){this._control.selectedIndex=t},enumerable:!0,configurable:!0}),i.prototype.addListen=function(){this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touch,this)},i.prototype.removeListen=function(){this.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touch,this)},i.prototype.touch=function(e){MyEvent.dispach(t.Data.TOUCH_GRID,{row:this._row,col:this._col})},i}(MyComponent);t.Grid=e,__reflect(e.prototype,"AstarPra.Grid")}(AstarPra||(AstarPra={}));var AstarPra;!function(t){var e=function(){function e(){this._straightCost=10,this._diagCost=14,this.init()}return Object.defineProperty(e,"instance",{get:function(){return this._inst||(this._inst=new e)},enumerable:!0,configurable:!0}),e.prototype.loadMap=function(t){this._map=t},e.prototype.setStartNode=function(t,e){this._startNode,this._startNode=this._nodes[t][e],this._startNode.g=0,this._startNode.h=this._heuristic(this._startNode),this._startNode.f=this._startNode.g+this._startNode.h},e.prototype.setEndNode=function(t,e){this._endNode=this._nodes[t][e]},e.prototype.setWalkable=function(t,e,i){this._nodes[t][e].walkable=i},e.prototype.getWalkable=function(t,e){return this._nodes[t][e].walkable},Object.defineProperty(e.prototype,"getStartNode",{get:function(){return this._startNode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"getEndNode",{get:function(){return this._endNode},enumerable:!0,configurable:!0}),e.prototype.reSetNode=function(){this._startNode=null,this._endNode=null,this._path=[],this.init()},e.prototype.init=function(){console.log("init Astar"),this._nodes=[],this._open=[],this._close=[];for(var e=0;e<t.Data.MAX_ROW;e++){this._nodes[e]=[];for(var i=0;i<t.Data.MAX_COL;i++)this._nodes[e][i]=new t.Node(e,i)}this._heuristic=this.manhattan},e.prototype.startAStar=function(){for(var e=this._startNode;e!=this._endNode;){for(var i=e.row-1;i<=e.row+1;i++)for(var r=e.col-1;r<=e.col+1;r++)if((i!=e.row||r!=e.col)&&!(i>t.Data.MAX_ROW-1||0>i||r>t.Data.MAX_COL-1||0>r||i!=e.row&&r!=e.col)){var o=this._nodes[i][r];if(o.walkable){this._map.gridList[i][r].control=5;var n=this._straightCost;o.row!=e.row&&o.col!=e.col&&(n=this._diagCost);var s=e.g+n,a=this._heuristic(o),h=s+a;if(this.isOpen(o)||this.isClose(o)?o.f>h&&(o.f=h,o.g=s,o.h=a,o.parent=e):(o.f=h,o.g=s,o.h=a,o.parent=e,this._open.push(o)),this.isClose(e)||this._close.push(e),0==this._open.length)return console.log("没有路径可以到达终点！"),!1;for(var c=this._open.length,p=0;c>p;p++)for(var l=p+1;c>l;l++)if(this._open[p].f>this._open[l].f){var u=this._open[p];this._open[p]=this._open[l],this._open[l]=u}}}e=this._open.shift()}return this.buildPath(),!0},e.prototype.buildPath=function(){this._path=[];var t=this._endNode;for(this._path.push(t);t!=this._startNode;)t=t.parent,this._path.unshift(t)},Object.defineProperty(e.prototype,"path",{get:function(){return this._path},enumerable:!0,configurable:!0}),e.prototype.isOpen=function(t){this._open.length;return this._open.indexOf(t)>-1?!0:!1},e.prototype.isClose=function(t){this._close.length;return this._close.indexOf(t)>-1?!0:!1},e.prototype.manhattan=function(e){return(t.Data.MAX_ROW-e.row+(t.Data.MAX_COL-e.col))*this._straightCost},e}();t.AStarModel=e,__reflect(e.prototype,"AstarPra.AStarModel")}(AstarPra||(AstarPra={}));var AstarPra;!function(t){var e=function(){function t(t,e){this.walkable=!0,this.row=t,this.col=e}return t}();t.Node=e,__reflect(e.prototype,"AstarPra.Node")}(AstarPra||(AstarPra={}));var AstarPra;!function(t){var e=function(){function t(){}return t}();t.NodeMgr=e,__reflect(e.prototype,"AstarPra.NodeMgr")}(AstarPra||(AstarPra={}));var AstarPra;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t._obstacle=.3,t}return __extends(i,e),i.prototype.myload=function(){this._re=this.getChild("re").asButton,this._start=this.getChild("start").asButton,this.initUi(),this.addListen()},i.prototype.initUi=function(){var e=this;this.gridList=[];for(var i=0;i<t.Data.MAX_ROW;i++){this.gridList[i]=[];for(var r=0;r<t.Data.MAX_COL;r++){var o=this.createObject("translucenceGrid");this.gridList[i][r]=o,o.x=20+(o.width+2)*r,o.y=300+(o.height+2)*i,o.row=i,o.col=r,this.addChild(o)}}setTimeout(function(){e.createMap(),t.AStarModel.instance.loadMap(e)},300)},i.prototype.addListen=function(){this._re.addClickListener(this.re,this),this._start.addClickListener(this.start,this),MyEvent.add(t.Data.TOUCH_GRID,this.touch,this)},i.prototype.removeListen=function(){this._re.removeClickListener(this.re,this),this._start.removeClickListener(this.start,this),MyEvent.off(t.Data.TOUCH_GRID,this.touch,this)},i.prototype.re=function(){for(var e=this,i=0;i<t.Data.MAX_ROW;i++)for(var r=0;r<t.Data.MAX_COL;r++)t.AStarModel.instance.setWalkable(i,r,!0),e.gridList[i][r].control=0;t.AStarModel.instance.reSetNode(),this.startGrid=null,this.endGrid=null,this.createMap()},i.prototype.start=function(){var e=this,i=egret.getTimer();if(t.AStarModel.instance.getStartNode&&(t.AStarModel.instance.startAStar(),console.log("费时：",(egret.getTimer()-i)/1e3+"s"),t.AStarModel.instance.path))for(var r=t.AStarModel.instance.path.length,o=function(i){setTimeout(function(){var o=t.AStarModel.instance.path[i].row,n=t.AStarModel.instance.path[i].col;e.gridList[o][n].control=3,0==i&&(e.gridList[o][n].control=1),i==r-1&&(e.gridList[o][n].control=2)},100*i)},n=0;r>n;n++)o(n)},i.prototype.createMap=function(){for(var e=this,i=0;i<t.Data.MAX_ROW;i++)for(var r=0;r<t.Data.MAX_COL;r++){var o=Math.random()<this._obstacle?!1:!0;o||(t.AStarModel.instance.setWalkable(i,r,!1),e.gridList[i][r].control=4)}},i.prototype.touch=function(e){var i=this,r=e.row,o=e.col;t.AStarModel.instance.getWalkable(r,o)&&(0==t.Data.touchNum?(i.startGrid&&(this.startGrid.control=0),t.AStarModel.instance.setStartNode(r,o),i.gridList[r][o].control=1,i.startGrid=i.gridList[r][o],t.Data.touchNum=1):(i.endGrid&&(this.endGrid.control=0),t.AStarModel.instance.setEndNode(r,o),i.gridList[r][o].control=2,i.endGrid=i.gridList[r][o],t.Data.touchNum=0))},i}(MyComponent);t.SeachMap=e,__reflect(e.prototype,"AstarPra.SeachMap")}(AstarPra||(AstarPra={}));var ComPools=function(){function t(){this._Pool={},this.POOL_MAX=10}return Object.defineProperty(t,"instance",{get:function(){return this._instance||(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.getCom=function(t){return this._Pool[t]||(this._Pool[t]=[]),0==this._Pool[t].length?fairygui.UIPackage.createObject(Data.pkgName,t).asCom:this._Pool[t].shift()},t.prototype.disposeCom=function(t,e){this._Pool[t]||(this._Pool[t]=[]),(this._Pool[t].length||e)&&(this._Pool[t].length<this.POOL_MAX?(this._Pool[t].push(e),e&&e.parent&&e.removeFromParent()):(e.asCom.dispose(),e=null))},t.prototype.destory=function(){this._Pool=null,t._instance=null},t}();__reflect(ComPools.prototype,"ComPools");var Data=function(){function t(){}return Object.defineProperty(t,"getWidth",{get:function(){return egret.lifecycle.stage.stageWidth},enumerable:!0,configurable:!0}),Object.defineProperty(t,"getHeight",{get:function(){return egret.lifecycle.stage.stageHeight},enumerable:!0,configurable:!0}),t.pkgName="practiceUI",t.NEXT_ROUND="next_round",t.ERROR_ANSWER="error_answer",t}();__reflect(Data.prototype,"Data");var Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),this.createGameScene(),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,3,,4]),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return e.sent(),[4,RES.loadGroup("preload")];case 2:return e.sent(),[3,4];case 3:return t=e.sent(),console.error(t),[3,4];case 4:return[2]}})})},e.prototype.createGameScene=function(){new MainPanel},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var GameMgr=function(){function t(){}return Object.defineProperty(t,"instance",{get:function(){return this._instance||(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.init=function(t){this._target=t,this._re=t.getChild("re").asButton,this._re.addClickListener(t.reStart,t),this._scoreText=t.getChild("score").asTextField,this._timeText=t.getChild("time").asTextField,this._scoreText.text="0"},Object.defineProperty(t.prototype,"setScore",{set:function(t){this._scoreText.text=t+""},enumerable:!0,configurable:!0}),t.prototype.setTime=function(){var t=this;this._time=60,this._timeText.text="60",this._timeId&&clearInterval(this._timeId),this._timeId=setInterval(function(){t._time--,t._timeText.text=t._time+"",0==t._time&&(clearInterval(t._timeId),t._target.gameOver())},1e3)},t.prototype.destory=function(){t._instance=null},t}();__reflect(GameMgr.prototype,"GameMgr");var MyEvent=function(){function t(){this.eventMap={}}return Object.defineProperty(t,"instance",{get:function(){return this._inst||(this._inst=new t),this._inst},enumerable:!0,configurable:!0}),t.add=function(e,i,r){t.instance.add(e,i,r)},t.off=function(e,i,r){t.instance.off(e,i,r)},t.dispach=function(e,i){t.instance.dispach(e,i)},t.prototype.add=function(t,e,i){this.eventMap[t]||(this.eventMap[t]=[]);var r={};r.callBack=e,r.thisObj=i,this.eventMap[t].push(r)},t.prototype.off=function(t,e,i){if(!t)return void(this.eventMap={});if(!e)return this.eventMap[t]=[],void delete this.eventMap[t];var r=this.eventMap[t];if(i&&r){for(var o=0;o<r.length;o++)r[o].callBack==e&&r[o].thisObj==i&&r.splice(o,1);r.length||delete this.eventMap[t]}},t.prototype.dispach=function(t,e){if(this.eventMap[t]&&this.eventMap[t].length)for(var i=this.eventMap[t],r=0;r<i.length;r++)i[r].callBack.call(i[r].thisObj,e)},t}();__reflect(MyEvent.prototype,"MyEvent");var DragPro;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.g=900,e.angle=0,e.gr=.2,e.minSpeed=5,e.maxPower=14,e.MAX_DISTANCE=200,e._drawCrew=20,e.MAX_INCREASE_SPEED=700,e.miniSpeed=300,e.DRAW_DISTANCE=15,e._pointList=[],e.scaleRate=5,e.P0=new egret.Point(0,350),e.P1XLimit=100,e.P2XLimit=300,e}return __extends(e,t),e.prototype.myload=function(){this.myinit(),this.addListen()},e.prototype.myinit=function(){this._initPoint=new egret.Point,this._lastPoint=new egret.Point},e.prototype.addListen=function(){this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touch,this),this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.touch,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.touch,this)},e.prototype.beginDrag=function(t){this._radian=0,this._initPoint=t},e.prototype.touch=function(t){switch(t.type){case"touchBegin":this._initPoint.x=t.stageX,this._initPoint.y=t.stageY,this._time=egret.getTimer();break;case"touchMove":if(this._lastPoint.x=t.stageX,this._lastPoint.y=t.stageY,this.testDrawPowerLine(this._initPoint,this._lastPoint),egret.getTimer()-this._time<50)return;this._time=egret.getTimer(),this._pointList&&this.releasePointList(),this.bezierParabola();break;case"touchEnd":this._powerLine&&this._powerLine.graphics.clear()}},e.prototype.testParabola=function(t,e){var i=egret.Point.distance(t,e),r=Math.atan2(e.y-t.y,e.x-t.x);console.log(i,r),this.powerRate=i/this.MAX_DISTANCE;var o=19;this._speedX=18,this._speedY=Math.sin(-r)*o;var n=Math.abs(r);n>=Math.PI/2&&n<=.75*Math.PI&&(this._speedX*=Math.cos(r)*Math.cos(Math.PI/4)),r<=Math.PI/2&&r>=-Math.PI/2&&(this._speedX=.1,this._speedY=Math.sin(-r)>0?19:-19),this._speedX=this._speedX<0?-this._speedX:this._speedX;var s=this.width/this._speedX;this._totalTime=s>150?150:s;for(var a=350,h=0,c=0;c<this._totalTime;){c+=1;var p=ComPools.instance.getCom("Point").asCom;p.x=h+=this._speedX,p.y=a+=this._speedY+=this.gr,this.addChild(p),this._pointList.push(p)}},e.prototype.test=function(t,e){var i=egret.Point.distance(t,e),r=Math.atan2(e.y-t.y,e.x-t.x);this.powerRate=i/this.MAX_DISTANCE;var o=18;this._speedX=Math.cos(r)*o,this._speedY=Math.sin(-r)*o,r<=Math.PI/2&&r>=-Math.PI/2&&(this._speedX=0,this._speedY=Math.sin(-r)>0?19:-19),this._speedX=this._speedX<0?-this._speedX:this._speedX;var n=this.width/this._speedX;this._totalTime=n>150?150:n;for(var s=350,a=0,h=0,c=1;h<this._totalTime;){h+=1;var p=ComPools.instance.getCom("Point").asCom;p.x=a+=this._speedX*c,p.y=s+=(this._speedY+=this.gr)*c,this.addChild(p),this._pointList.push(p)}},e.prototype.testDrawParabola=function(){var t=egret.Point.distance(this._initPoint,this._lastPoint);this.powerRate=t/this.MAX_DISTANCE,this.vSpeed=this.miniSpeed+Math.round(this.powerRate*this.MAX_INCREASE_SPEED),console.log(this.vSpeed);for(var e=350,i=0,r=100,o=0;r>0;){r--,o+=.02,i+=this.DRAW_DISTANCE,e=-(this.vSpeed*o*Math.sin(this.angle)-1e3*o*o/2)+350,console.log(this.vSpeed,e,o,Math.sin(this.angle),180*this.angle/Math.PI);var n=ComPools.instance.getCom("Point").asCom;n.x=i,n.y=e,this.addChild(n),this._pointList.push(n)}},e.prototype.releasePointList=function(){this._pointList&&(this._pointList.forEach(function(t){ComPools.instance.disposeCom("Point",t)}),this._pointList.length=0)},e.prototype.bezierParabola=function(){var t=(new egret.Point,egret.Point.distance(this._initPoint,this._lastPoint));t=t>this.MAX_DISTANCE?this.MAX_DISTANCE:t;var e=-t*Math.cos(this.angle)*this.scaleRate;e=e<this.P1XLimit?this.P1XLimit:e;var i=-t*Math.sin(this.angle)*this.scaleRate*2+this.P0.y;i=i>this.P0.y?this.P0.y:i,this.P1=egret.Point.create(e,i),this.drawTestPoint1(e,i);var r=-t*Math.cos(this.angle)*this.scaleRate*5;r=r<this.P2XLimit?this.P2XLimit:r;var o=this.height;this.P2=egret.Point.create(r,o),this.drawTestPoint2(r,o),this.testDrawBezier(this.P0,this.P1,this.P2),egret.Point.release(this.P1),egret.Point.release(this.P2)},e.prototype.drawTestPoint1=function(t,e){!this._testPoint1&&(this._testPoint1=new egret.Shape),this._testPoint1.graphics.clear(),this._testPoint1.graphics.beginFill(14614559),this._testPoint1.graphics.drawCircle(t,e,5),this._testPoint1.graphics.endFill(),this.displayListContainer.addChild(this._testPoint1)},e.prototype.drawTestPoint2=function(t,e){!this._testPoint2&&(this._testPoint2=new egret.Shape),this._testPoint2.graphics.clear(),this._testPoint2.graphics.beginFill(6271798),this._testPoint2.graphics.drawCircle(t,e,5),this._testPoint2.graphics.endFill(),this.displayListContainer.addChild(this._testPoint2)},e.prototype.testDrawBezier=function(t,e,i){this._bezierLine&&this._bezierLine.graphics.clear();var r=new egret.Shape;r.graphics.lineStyle(4,8900346,1,!1,"normal",null,null,3,[10,10]),r.graphics.moveTo(t.x,t.y),r.graphics.curveTo(e.x,e.y,i.x,i.y),r.graphics.endFill(),this.displayListContainer.addChild(r),this._bezierLine=r},e.prototype.testDrawPowerLine=function(t,e){this._powerLine||(this._powerLine=new egret.Shape);var i=egret.Point.distance(t,e);e=i>this.MAX_DISTANCE?egret.Point.interpolate(t,e,1-this.MAX_DISTANCE/i):e,this._lastPoint=e,this._powerLine.graphics.clear(),this._powerLine.graphics.lineStyle(2,3407667),this._powerLine.graphics.moveTo(t.x,t.y),this._powerLine.graphics.lineTo(e.x,e.y),this._powerLine.graphics.endFill(),this.displayListContainer.addChild(this._powerLine);var r=Math.atan2(e.y-t.y,e.x-t.x);this.angle=r},e}(MyComponent);t.DragDemoMain=e,__reflect(e.prototype,"DragPro.DragDemoMain")}(DragPro||(DragPro={}));var DragPro;!function(t){var e=function(){function t(){}return Object.defineProperty(t,"instance",{get:function(){return this._inst||(this._inst=new t)},enumerable:!0,configurable:!0}),t.prototype.start=function(){},t}();t.GameMgr=e,__reflect(e.prototype,"DragPro.GameMgr")}(DragPro||(DragPro={}));var DragPro;!function(t){var e=function(){function t(){}return Object.defineProperty(t,"instance",{get:function(){return this._inst||(this._inst=new t)},enumerable:!0,configurable:!0}),t.prototype.init=function(){},t.prototype.initDrag=function(t){this._radian=0,this._initPoint=t},t}();t.Model=e,__reflect(e.prototype,"DragPro.Model")}(DragPro||(DragPro={}));var MainPanel=function(t){function e(){return t.call(this,Data.pkgName,"GameMain")||this}return __extends(e,t),e.prototype.initComponents=function(){t.prototype.initComponents.call(this),this.registComponent("SwitchColor",Map1),this.registComponent("SwitchColorGrid",SwitchColorGrid),this.registComponent("PrimaryMath",Map2),this.registComponent("PrimaryMathGrid",PrimaryMathGrid),this.registComponent("MineSweeper",MineSweeper),this.registComponent("MineSweeperGrid",MineSweeperGrid),this.registComponent("Trailing",TrailingViaPic),this.registComponent("AStar",AstarPra.SeachMap),this.registComponent("translucenceGrid",AstarPra.Grid),this.registComponent("DragDemo",DragPro.DragDemoMain),this.registComponent("Trapezoid",DragPro.Trapezoid),this.registComponent("VirtualListMainView",VirtualListDemo.MainView),this.registComponent("ListCom",VirtualListDemo.ListCom)},e.prototype.initListen=function(){},e.prototype.removeListen=function(){},e.prototype.initView=function(){t.prototype.initView.call(this),this._map=this.createObject("Trailing"),this._ui.addChild(this._map),this.gameStart()},e.prototype.gameStart=function(){},e.prototype.gameOver=function(){},e}(FairyWindow);__reflect(MainPanel.prototype,"MainPanel");var MineEnum=function(){function t(){}return t.Empty=0,t.Mine=-1,t.SEARCH=1,t}();__reflect(MineEnum.prototype,"MineEnum");var MineSweeper=function(t){function e(){var e=t.call(this)||this;return e._maxRow=20,e._maxCol=20,e._mineNum=10,e._gridSize=35,e}return __extends(e,t),e.prototype.init=function(){MineSweeperModel.instance.init(this._maxRow,this._maxCol,this._mineNum),this._board=this.getChild("board").asCom,this._mineNumText=this.getChild("mine").asTextField,this._mineNumText.text=this._mineNum+"",this._timeText=this.getChild("time").asTextField,this._re=this.getChild("re").asButton,this.createMap(),this.startTimer(),this.addListen()},e.prototype.startTimer=function(){var t=this;this._timeId&&clearInterval(this._timeId),this._time=0,this._timeText.text="0",this._timeId=setInterval(function(){t._timeText.text=--t._time+""},1e3)},e.prototype.addListen=function(){this._board.addEventListener(egret.TouchEvent.TOUCH_TAP,this.touchGrid,this),MyEvent.add(MineDate.MAP_UPDATE,this.mapUpdate,this),MyEvent.add(MineDate.GAME_OVER,this.gameOver,this),this._re.addClickListener(this.reStart,this)},e.prototype.removeListen=function(){this._board.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.touchGrid,this),MyEvent.off(MineDate.MAP_UPDATE,this.mapUpdate,this),MyEvent.off(MineDate.GAME_OVER,this.gameOver,this)},e.prototype.createMap=function(){this._mapList=[];for(var t=0;t<this._maxRow;t++){this._mapList[t]=[];for(var e=0;e<this._maxCol;e++){var i=this.createObject("MineSweeperGrid");i.x=10+35*e,i.y=350+35*t,i.setPosition(t,e),this.addChild(i),this._mapList[t][e]=i}}},e.prototype.touchGrid=function(t){var e=Math.floor((t.stageY-350)/this._gridSize),i=Math.floor((t.stageX-10)/this._gridSize);this._mapList[e][i]&&this._mapList[e][i]._touch&&MineSweeperModel.instance.openMine(e,i)},e.prototype.mapUpdate=function(t){var e=this;console.log(t);for(var i=t.length,r=function(i){var r=t[i][0],n=t[i][1],s=t[i][2],a=o._mapList[r][n],h=setTimeout(function(){if(a instanceof MineSweeperGrid&&a.disappear(),clearTimeout(h),0!=s){var t=e.createObject("MineNum").asCom;t.x=a.x,t.y=a.y,t.getChild("num").text=s+"",e.addChildAt(t,10),e._mapList[r][n]=t}else e._mapList[r][n]=null},1*i)},o=this,n=0;i>n;n++)r(n)},e.prototype.reStart=function(){this.clearAll(),this._timeId&&clearInterval(this._timeId)&&(this._timeId=0),this._board.addEventListener(egret.TouchEvent.TOUCH_TAP,this.touchGrid,this),MineSweeperModel.instance.init(this._maxRow,this._maxCol,this._mineNum),this.createMap(),this.startTimer()},e.prototype.gameOver=function(t){var e=this._mapList[t.row][t.col],i=this.createObject("Mine").asCom;i.x=e.x,i.y=e.y,t.boom&&(i.getChild("boom").visible=!0,this._timeId&&clearInterval(this._timeId)&&(this._timeId=0),this._board.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.touchGrid,this)),this.addChild(i),e.parent&&e.removeFromParent(),this._mapList[t.row][t.col]=i},e.prototype.clearAll=function(){console.log(this._mapList),this._mapList.forEach(function(t){t.forEach(function(t){t&&t.parent&&t.dispose()})})},e.prototype.dispose=function(){this.removeListen(),t.prototype.dispose.call(this)},e}(MyComponent);__reflect(MineSweeper.prototype,"MineSweeper");var MineSweeperGrid=function(t){function e(){var e=t.call(this)||this;return e._touch=!0,e}return __extends(e,t),e.prototype.myload=function(){this.touchable=!1},e.prototype.setPosition=function(t,e){this._row=t,this._col=e},e.prototype.disappear=function(){var t=this;this.getTransition("disappear").play(function(){t.removeFromParent()})},Object.defineProperty(e.prototype,"row",{get:function(){return this._row},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"col",{get:function(){return this._col},enumerable:!0,configurable:!0}),e}(MyComponent);__reflect(MineSweeperGrid.prototype,"MineSweeperGrid");var MineSweeperModel=function(){function t(){this._isFirstTouch=1}return Object.defineProperty(t,"instance",{get:function(){return this._inst||(this._inst=new t)},enumerable:!0,configurable:!0}),t.prototype.init=function(t,e,i){this.logicMap=[],this._searchArr=[],this._isFirstTouch=1;for(var r=0;t>r;r++){this.logicMap[r]=[],this._searchArr[r]=[];for(var o=0;e>o;o++)this.logicMap[r][o]=MineEnum.Empty,this._searchArr[r][o]=MineEnum.Empty}this._mapRow=t,this._mapCol=e,this.createMine(i)},t.prototype.createMine=function(t){for(var e,i;t>0;)e=Math.floor(Math.random()*this._mapRow),i=Math.floor(Math.random()*this._mapCol),0==this.logicMap[e][i]&&(this.logicMap[e][i]=MineEnum.Mine,t--)},t.prototype.kaiGua=function(){for(var t=0;t<this._mapRow;t++)for(var e=0;e<this._mapCol;e++)this.logicMap[t][e]!=MineEnum.Mine&&this.openMine(t,e)},t.prototype.openMine=function(t,e){if(0!=this._isFirstTouch&&(this._isFirstTouch--,this.logicMap[t][e]==MineEnum.Mine&&(this.createMine(1),this.logicMap[t][e]=MineEnum.Empty)),this.logicMap[t][e]==MineEnum.Mine)console.log("GameOver!"),MyEvent.dispach(MineDate.GAME_OVER,{row:t,col:e,boom:!0}),this.logicMap[t][e]=MineEnum.Empty,this.openMinePosition();else{var i=this.findMineCount(t,e);if(0==i){this._updateList=[];var r=egret.getTimer();this.expandMap(t,e),MyEvent.dispach(MineDate.MAP_UPDATE,this._updateList);var o=egret.getTimer();console.log("耗时："+(o-r))}else MyEvent.dispach(MineDate.MAP_UPDATE,[[t,e,i]])}},t.prototype.openMinePosition=function(){for(var t=0;t<this._mapRow;t++)for(var e=0;e<this._mapCol;e++)this.logicMap[t][e]==MineEnum.Mine&&MyEvent.dispach(MineDate.GAME_OVER,{row:t,col:e})},t.prototype.expandMap=function(t,e){if(!this._searchArr[t][e]){this._searchArr[t][e]=1,this._updateList.push([t,e,0]);var i=0;if(this.logicMap[t][e]!=MineEnum.Mine)for(var r=t-1;t+1>=r;r++)for(var o=e-1;e+1>=o;o++)if((r!=t||o!=e)&&!(r>=this._mapRow||0>r||o>=this._mapCol||0>o))if(i=this.findMineCount(r,o),0==i)this.expandMap(r,o);else{if(this._searchArr[r][o])continue;this._searchArr[r][o]=1,this._updateList.push([r,o,i])}}},t.prototype.findMineCount=function(t,e){for(var i=0,r=t-1;t+1>=r;r++)for(var o=e-1;e+1>=o;o++)(r!=t||o!=e)&&(r>this._mapRow-1||0>r||o>this._mapCol-1||0>o||this.logicMap[r][o]==MineEnum.Mine&&i++);return i},t.prototype.findMineMap=function(t,e){MyEvent.dispach(MineDate.MAP_UPDATE)},t}();__reflect(MineSweeperModel.prototype,"MineSweeperModel");var MineDate=function(){function t(){}return t.MAP_UPDATE="mapUpdate",t.GAME_OVER="game_over",t}();__reflect(MineDate.prototype,"MineDate");var Map2=function(t){function e(){var e=t.call(this)||this;return e._gridNum=2,e._maxBits=10,e}return __extends(e,t),e.prototype.myload=function(){this._first=this.getChild("input1").asTextField,this._second=this.getChild("input2").asTextField,this._result=this.getChild("answer").asTextField},e.prototype.init=function(){this._score=0,this._operatorList=[],this.createOperator(),this.addListen(),GameMgr.instance.init(this),GameMgr.instance.setTime()},e.prototype.addListen=function(){MyEvent.add(Data.NEXT_ROUND,this.nextRound,this)},e.prototype.removeListen=function(){MyEvent.off(Data.NEXT_ROUND,this.nextRound,this)},e.prototype.createOperator=function(){this.clearGrid();for(var t=[0,1,2,3],e=this.creAlgorithm(),i=0;4>i;i++){var r=t.splice(Math.floor(Math.random()*t.length),1)[0];console.log(r);var o=ComPools.instance.getCom("PrimaryMathGrid");o.x=220+(o.width+40)*(i%this._gridNum),o.y=680+(o.height+30)*Math.floor(i/2),o.initGrid(r),r==e&&o.setKey(!0),this.addChild(o),this._operatorList.push(o)}},e.prototype.creAlgorithm=function(){var t,e=Math.floor(4*Math.random()),i=Math.ceil(Math.random()*this._maxBits),r=Math.ceil(Math.random()*this._maxBits);switch(e){case OperatorEnum.ADDITION:t=i+r;break;case OperatorEnum.SUBTRACTIN:t=i-r;break;case OperatorEnum.MULTIPLICATION:t=i*r;break;case OperatorEnum.DIVISION:var o=void 0;t=i*r,o=i,i=t,t=o}return this._first.text=i+"",this._second.text=r+"",this._result.text=t+"",e},e.prototype.nextRound=function(){this._score++,GameMgr.instance.setScore=this._score,this.clearGrid(),this.createOperator()},e.prototype.reStart=function(){GameMgr.instance.setScore=this._score=0,this._maxBits=10,this.createOperator(),GameMgr.instance.setTime()},e.prototype.gameOver=function(){this.clearGrid()},e.prototype.clearGrid=function(){this._operatorList&&this._operatorList.forEach(function(t){ComPools.instance.disposeCom("PrimaryMathGrid",t),t.release()}),this._operatorList=[]},e.prototype.dispose=function(){this.removeListen(),t.prototype.dispose.call(this)},e}(MyComponent);__reflect(Map2.prototype,"Map2");var OperatorEnum=function(){function t(){}return t.ADDITION=0,t.SUBTRACTIN=1,t.MULTIPLICATION=2,t.DIVISION=3,t}();__reflect(OperatorEnum.prototype,"OperatorEnum");var PrimaryMathGrid=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.myload=function(){this._control=this.getController("c1")},e.prototype.initGrid=function(t){this._control.selectedIndex=t,this._correctKey=!1,this.addListen()},e.prototype.setKey=function(t){this._correctKey=t},e.prototype.isCorrect=function(){console.log("---------",this._correctKey),this._correctKey?MyEvent.dispach(Data.NEXT_ROUND):MyEvent.dispach(Data.ERROR_ANSWER)},e.prototype.addListen=function(){this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.isCorrect,this)},e.prototype.removeListen=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.isCorrect,this)},e.prototype.release=function(){this.removeListen()},e.prototype.dispose=function(){this.removeListen(),t.prototype.dispose.call(this)},e}(MyComponent);__reflect(PrimaryMathGrid.prototype,"PrimaryMathGrid");var SwitchColorGrid=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.myload=function(){this._isKey=!1},Object.defineProperty(e.prototype,"isKey",{set:function(t){this._isKey=t},enumerable:!0,configurable:!0}),e.prototype.addListen=function(){this._isKey&&(this.touchable=!0,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.next,this))},e.prototype.next=function(t){MyEvent.dispach(Data.NEXT_ROUND)},e.prototype.dispose=function(){t.prototype.dispose.call(this),this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.next,this)},e}(MyComponent);__reflect(SwitchColorGrid.prototype,"SwitchColorGrid");var Map1=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.myload=function(){this._re=this.getChild("re").asButton,this._re.addClickListener(this.reStart,this),this._scoreText=this.getChild("score").asTextField,this._timeText=this.getChild("time").asTextField,this.addListen()
},e.prototype.addListen=function(){MyEvent.add(Data.NEXT_ROUND,this.nextRound,this)},e.prototype.removeListen=function(){MyEvent.off(Data.NEXT_ROUND,this.nextRound,this)},e.prototype.init=function(){this.Timer(),this._score=0,this._roundNum=1,this._maxGridNum=9,this._colorDefaultNum=50,this.clearGrid(),this._gridList=[],this.createGrid()},e.prototype.reStart=function(){this.setscore(0),this._timeId&&clearInterval(this._timeId),this.init()},e.prototype.setscore=function(t){this._scoreText.text=t.toString()},e.prototype.Timer=function(){var t=this;this._time=60,this._timeText.text=this._time+"",this._timeId=setInterval(function(){0==t._time&&(t.clearGrid(),clearInterval(t._timeId)),t._timeText.text=(t._time--).toString()},1e3)},e.prototype.createGrid=function(){var t,e,i,r,o,n=20;t=this._roundNum<this._maxGridNum?this._roundNum+1:this._maxGridNum,e=Math.pow(t,2),n=(this._maxGridNum-t+2)/this._maxGridNum*n,r=(this._maxGridNum-1.7)/this._maxGridNum*(Data.getWidth/t),i=(Data.getWidth-n*(t-1)-r*t)/2,this._diffGrid=Math.floor(Math.random()*e),o=this.setColor();for(var s=0;e>s;s++){var a=this.createObject("Grid").asCom,h=a.getChildAt(0).asGraph;h.width=h.height=a.width=a.height=r,a.x=i+(n+a.width)*(s%t),a.y=345+i+(n+a.height)*Math.floor(s/t),h.color=o,s==this._diffGrid&&(h.color=this._colorRound,a.isKey=!0,a.addListen()),this.addChild(a),this._gridList.push(a)}},e.prototype.nextRound=function(){this._score++,this._roundNum++,this.clearGrid(),this.createGrid(),this.setscore(this._score)},e.prototype.setColor=function(){var t,e,i;t=Math.floor(Math.random()*(255-this._colorDefaultNum)+this._colorDefaultNum),e=Math.floor(Math.random()*(255-this._colorDefaultNum)+this._colorDefaultNum),i=Math.floor(Math.random()*(255-this._colorDefaultNum)+this._colorDefaultNum),this._colorDefaultNum>5&&(this._colorDefaultNum-=3),this._colorRound=(t-this._colorDefaultNum<<16)+(e-this._colorDefaultNum<<8)+i-this._colorDefaultNum;var r=(t<<16)+(e<<8)+i;return r},e.prototype.clearGrid=function(){this._gridList&&this._gridList.forEach(function(t){t&&t.parent&&t.removeFromParent(),t.dispose()}),this._gridList=[]},e.prototype.dispose=function(){t.prototype.dispose.call(this),this.removeListen()},e}(MyComponent);__reflect(Map1.prototype,"Map1");var MyRender=function(){function t(){}return t.prototype.create=function(){egret.sys.systemRenderer},t}();__reflect(MyRender.prototype,"MyRender");var TrailingViaPic=function(t){function e(){var e=t.call(this)||this;return e._lineArr=[],e._rectWidth=3,e._rectHeight=30,e._maxScale=.4,e._increScale=.2,e._reducScale=.07,e}return __extends(e,t),e.prototype.myload=function(){this.addListen()},e.prototype.addListen=function(){this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouch,this),this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouch,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouch,this),this.addEventListener(egret.Event.ENTER_FRAME,this.clean,this)},e.prototype.removeListen=function(){this.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouch,this),this.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouch,this),this.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouch,this),this.removeEventListener(egret.Event.ENTER_FRAME,this.clean,this)},e.prototype.onTouch=function(t){switch(t.type){case"touchBegin":this._oldTouchX=t.stageX,this._oldTouchY=t.stageY;break;case"touchMove":var e=t.stageX-this._oldTouchX,i=t.stageY-this._oldTouchY,r=Math.pow(e*e+i*i,.5),o=Math.acos(e/r);o*=0>i?-1:1,this.createOneRect(r,o),this._oldTouchX=t.stageX,this._oldTouchY=t.stageY;break;case"touchEnd":if(this._lineArr.length>0)for(var n=0;n<this._lineArr.length;n++)this._lineArr[n].type=1}},e.prototype.createOneRect=function(t,e){var i=t/2,r=this._oldTouchX+i*Math.cos(e),o=this._oldTouchY+i*Math.sin(e);this._rectWidth=t,this.createRect(r,o,e)},e.prototype.createMultiRect=function(t,e){for(var i=Math.ceil(t/this._rectWidth),r=0;i>r;r++){var o=this._rectWidth*(r+.5),n=o*Math.cos(e),s=o*Math.sin(e),a=this._oldTouchX+n,h=this._oldTouchY+s;this.createRect(a,h,e)}},e.prototype.createRect=function(t,e,i){var r=this.getShape();r.width=this._rectWidth,r.height=this._rectHeight,r.rotation=180*i/Math.PI||0,r.setPivot(.5,.5,!0),r.type=0,r.x=t,r.y=e,r.scaleX=1,r.scaleY=0,this.addChild(r),this._lineArr.push(r)},e.prototype.clean=function(){if(this._lineArr.length>0)for(var t=0;t<this._lineArr.length;t++)0==this._lineArr[t].type&&this._lineArr[t].scaleY<this._maxScale?this._lineArr[t].scaleY=this._lineArr[t].scaleY+this._increScale:(this._lineArr[t].type=1,this._lineArr[t].scaleY=this._lineArr[t].scaleY-this._reducScale,this._lineArr[t].scaleY<=0&&(this.cacheShape(this._lineArr[t]),this._lineArr.splice(t--,1)));return!1},e.prototype.getShape=function(){var t,e=this;return t=e._picPool&&0!=e._picPool.length?e._picPool.shift():fairygui.UIPackage.createObject(Data.pkgName,"pic").asImage},e.prototype.cacheShape=function(t){var e=this;e._picPool||(e._picPool=[]),e._picPool.length<100?(t.removeFromParent(),t.scaleX=1,t.scaleY=1,e._picPool.push(t)):(t.dispose(),t=null)},e.prototype.dispose=function(){this.removeListen(),this._picPool=null,this._lineArr=null,t.prototype.dispose.call(this)},e}(MyComponent);__reflect(TrailingViaPic.prototype,"TrailingViaPic");var TrailingCs=function(_super){function TrailingCs(){var t=_super.call(this)||this;return t.LineArr=[],t}return __extends(TrailingCs,_super),TrailingCs.prototype.myload=function(){this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onStageTouch,this),this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onStageTouch,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.onStageTouch,this),this.addEventListener(egret.Event.ENTER_FRAME,this.clean,this),this.draw()},TrailingCs.prototype.draw=function(){console.log("===========");var t=new egret.Shape;t.graphics.lineStyle(1,37779),t.graphics.beginFill(13500416),t.graphics.moveTo(100,100),t.graphics.lineTo(200,200),t.graphics.lineTo(200,100),t.graphics.lineTo(100,100),t.graphics.endFill(),egret.lifecycle.stage.addChild(t);var e=new fairygui.GGraph;e.setSize(100,100),e.setXY(100,200),e.drawRect(2,255,255,65280,255),this.addChild(e)},TrailingCs.prototype.dis=function(x1,x2,y1,y2){var x1=x1,y1=eval(y1),x2=eval(x2),y2=eval(y2),calX=x2-x1,calY=y2-y1;return Math.pow(calX*calX+calY*calY,.5)},TrailingCs.prototype.createLine=function(t,e){var i=this.createObject("effect");i.type=0,i.setPivot(.5,.5,!0),i.x=t,i.y=e,i.scaleX=.2,i.scaleY=.2,this.addChild(i),this.LineArr.push(i)},TrailingCs.prototype.onStageTouch=function(t){if("touchBegin"==t.type);else if("touchMove"==t.type){if(this.LineArr.length>0){var e=this.LineArr[this.LineArr.length-1].x,i=this.LineArr[this.LineArr.length-1].y,r=t.stageX,o=t.stageY,n=this.dis(e,r,i,o);if(n>5){var s=(e+r)/2,a=(i+o)/2,h=(e+s)/2,c=(i+a)/2,p=(h+r)/2,l=(c+o)/2,u=(e+h)/2,d=(i+c)/2,_=(h+s)/2,f=(c+a)/2,g=(s+p)/2,y=(a+l)/2,m=(p+r)/2,v=(l+o)/2;this.createLine(u,d),this.createLine(h,c),this.createLine(_,f),this.createLine(s,a),this.createLine(g,y),this.createLine(p,l),this.createLine(m,v)}}this.createLine(t.stageX,t.stageY)}else"touchEnd"==t.type},TrailingCs.prototype.clean=function(){if(this.LineArr.length>0)for(var t=0;t<this.LineArr.length;t++)this.LineArr[t].scaleX<.6&&0==this.LineArr[t].type?(this.LineArr[t].scaleX=this.LineArr[t].scaleX+.06,this.LineArr[t].scaleY=this.LineArr[t].scaleY+.06):(this.LineArr[t].type=1,this.LineArr[t].scaleX=this.LineArr[t].scaleX-.06,this.LineArr[t].scaleY=this.LineArr[t].scaleY-.06,this.LineArr[t].scaleX<=0&&(this.removeChild(this.LineArr[t]),this.LineArr.splice(t,1),t--))},TrailingCs}(MyComponent);__reflect(TrailingCs.prototype,"TrailingCs");var BezierSmoothPath=function(){function t(){}return t.getPoint=function(t,e){var i=e[0],r=e[1],o=e[2],n=e[3],s=i.x*Math.pow(1-t,3)+3*r.x*t*Math.pow(1-t,2)+3*o.x*t*t*(1-t)+n.x*Math.pow(t,3),a=i.y*Math.pow(1-t,3)+3*r.y*t*Math.pow(1-t,2)+3*o.y*t*t*(1-t)+n.y*Math.pow(t,3);return{x:s,y:a}},t.getBezierPoints=function(e,i,r){void 0===i&&(i=0),void 0===r&&(r=!0);for(var o=[],n=0,s=e.length-3;s>=n;n++){var a=t.getOffsetLine(e[n],e[n+1],e[n+2],i,r);o=o.concat(a)}var h=e[0],c=e[e.length-1],p=h.x==c.x&&h.y==c.y;if(p){var a=t.getOffsetLine(e[e.length-2],e[0],e[1],i,r);o=o.concat(a)}for(var l=[],n=0,u=0,s=e.length-1;s>n;n++)0==n?(l.push(e[n]),p?l.push(o[o.length-1]):l.push(e[n]),l.push(o[u++]),l.push(e[n+1])):n==s-1?(l.push(e[n]),l.push(o[u++]),p?l.push(o[u++]):l.push(e[n+1]),l.push(e[n+1])):(l.push(e[n]),l.push(o[u++]),l.push(o[u++]),l.push(e[n+1]));return{finalPoints:l,supPoints:o}},t.getOffsetLine=function(t,e,i,r,o){var n={};n.x=(t.x+e.x)/2,n.y=(t.y+e.y)/2;var s={};s.x=(e.x+i.x)/2,s.y=(e.y+i.y)/2;var a={};a.x=(n.x+s.x)/2,a.y=(n.y+s.y)/2,o&&(r=Math.min(Math.max(r,0),1));var h=n.x-a.x,c=n.y-a.y;n.x-=h*(1-r),n.y-=c*(1-r);var p=s.x-a.x,l=s.y-a.y;s.x-=p*(1-r),s.y-=l*(1-r);var u=e.x-a.x,d=e.y-a.y;return n.x+=u,n.y+=d,s.x+=u,s.y+=d,[n,s]},t}();__reflect(BezierSmoothPath.prototype,"BezierSmoothPath");var SwordTrail=function(){function t(){}return t}();__reflect(SwordTrail.prototype,"SwordTrail");var Trailing=function(t){function e(){var e=t.call(this)||this;return e._lineArr=[],e._density=0,e._rectWidth=3,e._rectHeight=30,e}return __extends(e,t),e.prototype.myload=function(){this.addListen()},e.prototype.addListen=function(){this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouch,this),this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouch,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouch,this),this.addEventListener(egret.Event.ENTER_FRAME,this.clean,this)},e.prototype.init=function(){},e.prototype.onTouch=function(t){switch(t.type){case"touchBegin":this._oldTouchX=t.stageX,this._oldTouchY=t.stageY;break;case"touchMove":var e=t.stageX-this._oldTouchX,i=t.stageY-this._oldTouchY,r=Math.pow(e*e+i*i,.5),o=Math.acos(e/r),n=0>i?-o:o;this.createOneRect(r,o,n,i),this._oldTouchX=t.stageX,this._oldTouchY=t.stageY;break;case"touchEnd":if(this._lineArr.length>0)for(var s=0;s<this._lineArr.length;s++)this._lineArr[s].type=1}},e.prototype.createOneRect=function(t,e,i,r){var o=t/2,n=o*Math.cos(e),s=o*Math.sin(e);s*=0>r?-1:1;var a=this._oldTouchX+n,h=this._oldTouchY+s;this._rectWidth=t,this.createRect(a,h,i)},e.prototype.createMultiRect=function(t,e,i,r){for(var o=this._rectWidth,n=Math.ceil(t/o),s=0;n>s;s++){var a=o*(s+.5),h=a*Math.cos(e),c=a*Math.sin(e);c*=0>r?-1:1;var p=this._oldTouchX+h,l=this._oldTouchY+c;this.createRect(p,l,i)}},e.prototype.createRect=function(t,e,i){var r=this.getShape();console.log(r.hashCode),r.graphics.beginFill(16751001),r.graphics.drawRect(0,0,this._rectWidth,this._rectHeight),r.graphics.endFill(),r.rotation=180*i/Math.PI||0,r.type=0,r.x=t,r.y=e,r.scaleX=1,r.scaleY=0,r.anchorOffsetX=r.width/2,r.anchorOffsetY=r.height/2,this.displayListContainer.addChild(r),this._lineArr.push(r)},e.prototype.clean=function(){if(this._lineArr.length>0)for(var t=0;t<this._lineArr.length;t++)this._lineArr[t].scaleY<.4&&0==this._lineArr[t].type?this._lineArr[t].scaleY=this._lineArr[t].scaleY+.2:(this._lineArr[t].type=1,this._lineArr[t].scaleY=this._lineArr[t].scaleY-.1,this._lineArr[t].scaleY<=0&&(this.displayListContainer.removeChild(this._lineArr[t]),this.cacheShape(this._lineArr[t]),this._lineArr.splice(t--,1)));return!1},e.prototype.getShape=function(){var t=this;if(this._shapePool)var e=t._shapePool.shift();return e&&(e.visible=!0),e||new egret.Shape},e.prototype.cacheShape=function(t){this._shapePool||(this._shapePool=[]);var e=this;t.visible=!1,t.alpha=1,t.scaleX=1,t.scaleY=1,t.graphics.clear(),e._shapePool.push(t)},e}(MyComponent);__reflect(Trailing.prototype,"Trailing");var Trailing2=function(t){function e(){var e=t.call(this)||this;return e._lineArr=[],e._density=0,e._rectWidth=3,e._rectHeight=30,e}return __extends(e,t),e.prototype.myload=function(){this.addListen()},e.prototype.addListen=function(){this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouch,this),this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouch,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouch,this),this.addEventListener(egret.Event.ENTER_FRAME,this.clean,this)},e.prototype.init=function(){},e.prototype.onTouch=function(t){switch(t.type){case"touchBegin":this.createRect(t.stageX,t.stageY),this._oldTouchX=t.stageX,this._oldTouchY=t.stageY;break;case"touchMove":var e=t.stageX-this._oldTouchX,i=t.stageY-this._oldTouchY,r=Math.pow(e*e+i*i,.5),o=Math.acos(e/r),n=0>i?-o:o;this.createOneRect(r,o,n,i),this._oldTouchX=t.stageX,this._oldTouchY=t.stageY;break;case"touchEnd":if(this._lineArr.length>0)for(var s=0;s<this._lineArr.length;s++)this._lineArr[s].type=1}},e.prototype.createTriangle=function(t,e,i,r){var o=new egret.Shape;o.graphics.beginFill(16751001),o.graphics.moveTo(t-i/2,e-this._rectHeight/2),o.graphics.lineTo(t+i/2,e),o.graphics.lineTo(t-i/2,e+this._rectHeight/2),o.graphics.lineTo(t-i/2,e+this._rectHeight),o.graphics.endFill(),o.rotation=180*r/Math.PI||0,o.angle=r,o.x1=t,o.y1=e,this._oldTriangle=o,this.displayListContainer.addChild(o)},e.prototype.createOneRect=function(t,e,i,r){var o=t/2,n=o*Math.cos(e),s=o*Math.sin(e);s*=0>r?-1:1;var a=this._oldTouchX+n,h=this._oldTouchY+s;this._rectWidth=t,this._oldTriangle&&(this.createRect(this._oldTriangle.x1,this._oldTriangle.y1,this._oldTriangle.angle),this.displayListContainer.removeChild(this._oldTriangle)),this.createTriangle(a,h,t,i)},e.prototype.createMultiRect=function(t,e,i,r){for(var o=this._rectWidth,n=Math.ceil(t/o),s=0;n>s;s++){var a=o*s+o/2,h=a*Math.cos(e),c=a*Math.sin(e);c*=0>r?-1:1;var p=this._oldTouchX+h,l=this._oldTouchY+c;this.createRect(p,l,i)}},e.prototype.createRect=function(t,e,i){var r=this.getShape();r.graphics.beginFill(16751001),r.graphics.drawRect(0,0,this._rectWidth,this._rectHeight),r.graphics.endFill(),r.rotation=180*i/Math.PI||0,r.type=0,r.x=t,r.y=e,r.scaleX=1,r.scaleY=0,r.anchorOffsetX=r.width/2,r.anchorOffsetY=r.height/2,this.displayListContainer.addChild(r),this._lineArr.push(r)},e.prototype.clean=function(){if(this._lineArr.length>0)for(var t=0;t<this._lineArr.length;t++)this._lineArr[t].scaleY<.6&&0==this._lineArr[t].type?this._lineArr[t].scaleY=this._lineArr[t].scaleY+.06:(this._lineArr[t].type=1,this._lineArr[t].scaleY=this._lineArr[t].scaleY-.1,this._lineArr[t].scaleY<=0&&(this.displayListContainer.removeChild(this._lineArr[t]),this._lineArr.splice(t--,1)));return!1},e.prototype.getShape=function(){var t=this;if(this._shapePool)var e=t._shapePool.shift();return e&&(e.visible=!0),e||new egret.Shape},e.prototype.cacheShape=function(t){var e=this;t.visible=!1,t.alpha=1,t.scaleX=1,t.scaleY=1,t.graphics.clear(),e._shapePool.push(t)},e}(MyComponent);__reflect(Trailing2.prototype,"Trailing2");var TrailRenderer=function(t){function e(){var e=t.call(this)||this;e.trailShapeCache=[],e.curColorIdx=0;var i=e;return i.once(egret.Event.ADDED_TO_STAGE,i.onAdded,i),i.once(egret.Event.REMOVED_FROM_STAGE,i.onRemoved,i),e}return __extends(e,t),e.prototype.init=function(t,e,i,r,o,n,s){void 0===t&&(t=500),void 0===e&&(e=1),void 0===i&&(i=0),void 0===r&&(r=[16777215]),void 0===o&&(o=0),void 0===n&&(n=0),void 0===s&&(s=egret.Ease.sineInOut);var a=this;a.trailDensity=o,a.trailLife=t,a.trailColors=r,a.trailWidth=n,a.alphaFrom=e,a.alphaTo=i,a.curColorIdx=0,a.inited=!0},e.prototype.onAdded=function(t){var e=this;e.addEventListener(egret.Event.ENTER_FRAME,e.onFrameEnter,e),e.target=e.parent,e.trailWidth=e.trailWidth||e.target.width},e.prototype.onRemoved=function(t){var e=this;e.trailShapeCache=null,e.removeEventListener(egret.Event.ENTER_FRAME,e.onFrameEnter,e)},e.prototype.onFrameEnter=function(t){var e=this;e.target&&e.inited&&e.drawTrail()},e.prototype.drawTrail=function(){var t=this;t.lastTargetPos||(t.lastTargetPos={},t.lastTargetPos.x=t.target.x,t.lastTargetPos.y=t.target.y);for(var e=t.target.x-t.lastTargetPos.x,i=t.target.y-t.lastTargetPos.y,r=Math.sqrt(e*e+i*i),o=Math.acos(e/r),n=t.getCurColor(),s=t.trailDensity||r,a=function(e){var a=r/s*e,h=a*Math.cos(o),c=a*Math.sin(o);c*=0>i?-1:1;var p=t.target.x-h,l=t.target.y-c,u=t.drawTrailShape(p,l,n);t.addTrailShape(u);var d=33,_=1-d/t.trailLife/s*e;egret.Tween.get(u).set({scaleX:_,scaleY:_}).to({alpha:t.alphaTo,scaleX:0,scaleY:0},t.trailLife,t.trailEase).call(function(){t.removeTrailShape(u),t.cacheShape(u)})},h=0;s>h;h++)a(h);t.lastTargetPos.x=t.target.x,t.lastTargetPos.y=t.target.y},e.prototype.addTrailShape=function(t){var e=this;e.target.parent.addChildAt(t,0)},e.prototype.removeTrailShape=function(t){var e=this;e.target.parent.removeChild(t)},e.prototype.drawTrailShape=function(t,e,i){var r=this,o=r.getCacheShape()||new egret.Shape;return o.graphics.beginFill(i,r.alphaFrom),o.graphics.drawCircle(0,0,.5*r.trailWidth),o.graphics.endFill(),o.x=t,o.y=e,o},e.prototype.getCurColor=function(){var t=this,e=t.trailColors[t.curColorIdx++];return t.curColorIdx>t.trailColors.length-1&&(t.curColorIdx=0),e},e.prototype.getCacheShape=function(){var t=this,e=t.trailShapeCache.pop()||null;return e&&(e.visible=!0),e},e.prototype.cacheShape=function(t){var e=this;t.visible=!1,t.alpha=1,t.scaleX=1,t.scaleY=1,t.graphics.clear(),e.trailShapeCache.push(t)},e}(egret.Sprite);__reflect(TrailRenderer.prototype,"TrailRenderer");var VirtualListDemo;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.myload=function(){this._itemName=this.getChild("itemName").asTextField,this._itemDesc=this.getChild("itemDesc").asTextField,this._btnAcpt=this.getChild("acptBtn").asButton,this._btnAcpt.addClickListener(this.acept,this)},e.prototype.setData=function(t){this._itemName.text=t.itemName,this._itemDesc.text=t.desc,this._taskId=t.id,this._btnAcpt.enabled=!0,0==t.state?(this._btnAcpt.enabled=!1,this._btnAcpt.selected=!1):1==t.state?this._btnAcpt.selected=!1:(this._btnAcpt.touchable=!1,this._btnAcpt.selected=!0)},e.prototype.acept=function(){MyEvent.dispach("touchAcpt",this._taskId)},e.prototype.changeState=function(){this._btnAcpt.selected=!0,this._btnAcpt.touchable=!1,this._btnAcpt.enabled=!0},e}(MyComponent);t.ListCom=e,__reflect(e.prototype,"VirtualListDemo.ListCom")}(VirtualListDemo||(VirtualListDemo={}));var VirtualListDemo;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e._virtualData=[],e._dataLen=14,e._finishedIdList=[3,5,1,6],e._gottaList=[],e}return __extends(e,t),e.prototype.myload=function(){this._list=this.getChild("list").asList,this.addListen()},e.prototype.init=function(){this.parseData(),this.updataListData(),this._list.itemRenderer=this.renderItem,this._list.setVirtual(),this._list.numItems=e.listData.length},e.prototype.addListen=function(){MyEvent.add("touchAcpt",this.refreshTask,this)},e.prototype.removeListen=function(){MyEvent.off("touchAcpt",this.refreshTask,this)},e.prototype.parseData=function(){var t=RES.getRes("virtualListDemoData_json");for(var e in t)this._virtualData.push({id:t[e].id,itemName:t[e].condition,desc:t[e].describe,state:0})},e.prototype.renderItem=function(t,i){i.setData(e.listData[t])},e.prototype.getFinishedList=function(){return this._finishedIdList.sort(function(t,e){return t-e})},e.prototype.refreshTask=function(t){for(var i=0,r=0;r<e.listData.length;r++){var o=e.listData[r];if(t==o.id){i=r,this._gottaList.push(t),this._finishedIdList.splice(this._finishedIdList.indexOf(t),1);break}}console.log("已完成列表："+this._finishedIdList),console.log("已领取列表："+this._gottaList);this._list.getChildAt(i);this.updataListData(),this._list.numItems=e.listData.length},e.prototype.updataListData=function(){for(var t=[],i=0;i<this._dataLen;i++)t[i]=this._virtualData[i];for(var i=0;i<t.length;i++)if(-1!=this.getFinishedList().indexOf(t[i].id)){var r=t.splice(i,1)[0];r.state=1,t.unshift(r)}for(var i=t.length-1;i>=0;i--)if(-1!=this._gottaList.indexOf(t[i].id)){var r=t.splice(i,1)[0];r.state=2,t.push(r)}e.listData=t},e.listData=[],e}(MyComponent);t.MainView=e,__reflect(e.prototype,"VirtualListDemo.MainView")}(VirtualListDemo||(VirtualListDemo={}));